{% extends 'base.html' %}
{% load static %}

{% block title %}–°–ø–∏—Å–æ–∫ –æ–±—ä—è–≤–ª–µ–Ω–∏–π{% endblock %}

{% block content %}
<h2>–°–ø–∏—Å–æ–∫ –æ–±—ä—è–≤–ª–µ–Ω–∏–π</h2>

<!-- –§–æ—Ä–º–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∏ –ø–æ–∏—Å–∫–∞ -->
<form method="GET" id="filter-form" action="{% url 'ad_list' %}" class="mb-4">
    <div class="row">
        <!-- –ü–æ–∏—Å–∫ -->
        <div class="col-md-4 mb-3">
            <label for="search">–ü–æ–∏—Å–∫</label>
            <input type="text" name="q" id="search" class="form-control" value="{{ request.GET.q }}" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ">
        </div>

        <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏—è -->
        <div class="col-md-4 mb-3">
            <label for="category">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
            <select name="category" id="category" class="form-control">
                <option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                {% for category in categories %}
                    <option value="{{ category.id }}" {% if selected_category == category.id %}selected{% endif %}>
                        {{ category.name }}
                    </option>
                {% endfor %}
            </select>
        </div>

        <!-- –¶–µ–Ω–∞ –æ—Ç -->
        <div class="col-md-2 mb-3">
            <label for="price_min">–¶–µ–Ω–∞ –æ—Ç</label>
            <input type="number" name="price_min" id="price_min" class="form-control" value="{{ price_min }}" placeholder="–û—Ç">
        </div>

        <!-- –¶–µ–Ω–∞ –¥–æ -->
        <div class="col-md-2 mb-3">
            <label for="price_max">–¶–µ–Ω–∞ –¥–æ</label>
            <input type="number" name="price_max" id="price_max" class="form-control" value="{{ price_max }}" placeholder="–î–æ">
        </div>

        <!-- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ -->
        <div class="col-md-3 mb-3">
            <label for="sort_by">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞</label>
            <select name="sort_by" id="sort_by" class="form-control">
                <option value="date" {% if sort_by == 'date' %}selected{% endif %}>–ü–æ –¥–∞—Ç–µ</option>
                <option value="price_asc" {% if sort_by == 'price_asc' %}selected{% endif %}>–¶–µ–Ω–∞ ‚Üë</option>
                <option value="price_desc" {% if sort_by == 'price_desc' %}selected{% endif %}>–¶–µ–Ω–∞ ‚Üì</option>
            </select>
        </div>

        <!-- –ö–Ω–æ–ø–∫–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ -->
        <div class="col-md-9 d-flex align-items-end">
            <button type="submit" class="btn btn-primary me-2">–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</button>
            <a href="{% url 'ad_list' %}" class="btn btn-secondary">–°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</a>
        </div>
    </div>
</form>

<!-- –°–ø–∏—Å–æ–∫ –æ–±—ä—è–≤–ª–µ–Ω–∏–π -->
<div id="ad-list">
    <div class="row">
        {% for ad in ads %}
            <div class="col-md-4 mb-4">
                <div class="card h-100">
                    {% if ad.image %}
                        <img class="card-img-top" src="{{ ad.image.url }}" alt="Image for {{ ad.title }}">
                    {% else %}
                        <img class="card-img-top" src="{% static 'default_image.jpg' %}" alt="Default image">
                    {% endif %}
                    <div class="card-body d-flex flex-column">
                        <h5 class="card-title">{{ ad.title }}</h5>
                        <p class="card-text">{{ ad.description|truncatewords:20 }}</p>
                        <a href="{% url 'ad_detail' ad.id %}" class="btn btn-primary mt-auto">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</a>
                    </div>
                </div>
            </div>
        {% empty %}
            <p>–ü–æ–∫–∞ –Ω–µ—Ç –æ–±—ä—è–≤–ª–µ–Ω–∏–π</p>
        {% endfor %}
    </div>
</div>

<!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
{% if ads.has_other_pages %}
<div class="pagination d-flex justify-content-center mt-4">
    <nav>
        <ul class="pagination">
            {% if ads.has_previous %}
                <li class="page-item">
                    <a class="page-link" href="?page=1&category={{ selected_category }}&price_min={{ price_min }}&price_max={{ price_max }}&q={{ request.GET.q }}&sort_by={{ sort_by }}">¬´ –ü–µ—Ä–≤–∞—è</a>
                </li>
                <li class="page-item">
                    <a class="page-link" href="?page={{ ads.previous_page_number }}&category={{ selected_category }}&price_min={{ price_min }}&price_max={{ price_max }}&q={{ request.GET.q }}&sort_by={{ sort_by }}">‚Äπ –ù–∞–∑–∞–¥</a>
                </li>
            {% endif %}

            <li class="page-item disabled">
                <span class="page-link">–°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ ads.number }} –∏–∑ {{ ads.paginator.num_pages }}</span>
            </li>

            {% if ads.has_next %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ ads.next_page_number }}&category={{ selected_category }}&price_min={{ price_min }}&price_max={{ price_max }}&q={{ request.GET.q }}&sort_by={{ sort_by }}">–í–ø–µ—Ä—ë–¥ ‚Ä∫</a>
                </li>
                <li class="page-item">
                    <a class="page-link" href="?page={{ ads.paginator.num_pages }}&category={{ selected_category }}&price_min={{ price_min }}&price_max={{ price_max }}&q={{ request.GET.q }}&sort_by={{ sort_by }}">–ü–æ—Å–ª–µ–¥–Ω—è—è ¬ª</a>
                </li>
            {% endif %}
        </ul>
    </nav>
</div>
{% endif %}

<!-- –î–æ–±–∞–≤–∏—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ -->
<div class="mt-4">
    {% if user.is_authenticated %}
        <a href="{% url 'ad_create' %}" class="btn btn-success">‚ûï –î–æ–±–∞–≤–∏—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ</a>
    {% else %}
        <a href="{% url 'login' %}" class="btn btn-primary">üîê –í–æ–π—Ç–∏</a>
    {% endif %}
</div>

<script src="{% static 'js/filter.js' %}"></script>

{% endblock %}
